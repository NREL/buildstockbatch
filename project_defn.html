

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Project Definition &mdash; buildstockbatch 0.20 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/changelog.css" type="text/css" />
  <link rel="stylesheet" href="_static/sphinx_paramlinks.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Samplers" href="samplers/index.html" />
    <link rel="prev" title="Installation" href="installation.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> buildstockbatch
          

          
          </a>

          
            
            
              <div class="version">
                0.20
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Project Definition</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#reference-the-project">Reference the project</a></li>
<li class="toctree-l2"><a class="reference internal" href="#weather-files">Weather Files</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#custom-weather-files">Custom Weather Files</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#sampler">Sampler</a></li>
<li class="toctree-l2"><a class="reference internal" href="#workflow-generator">Workflow Generator</a></li>
<li class="toctree-l2"><a class="reference internal" href="#baseline-simulations-incl-sampling-algorithm">Baseline simulations incl. sampling algorithm</a></li>
<li class="toctree-l2"><a class="reference internal" href="#openstudio-version-overrides">OpenStudio Version Overrides</a></li>
<li class="toctree-l2"><a class="reference internal" href="#upgrade-scenarios">Upgrade Scenarios</a></li>
<li class="toctree-l2"><a class="reference internal" href="#output-directory">Output Directory</a></li>
<li class="toctree-l2"><a class="reference internal" href="#eagle-configuration">Eagle Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="#aws-configuration">AWS Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="#postprocessing">Postprocessing</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#uploading-to-aws-athena">Uploading to AWS Athena</a></li>
<li class="toctree-l3"><a class="reference internal" href="#postprocessing-configuration-options">Postprocessing Configuration Options</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="samplers/index.html">Samplers</a></li>
<li class="toctree-l1"><a class="reference internal" href="workflow_generators/index.html">Workflow Generators</a></li>
<li class="toctree-l1"><a class="reference internal" href="filtering_logic.html">Filtering Logic</a></li>
<li class="toctree-l1"><a class="reference internal" href="run_sims.html">Running a Project</a></li>
</ul>
<p class="caption"><span class="caption-text">Changes &amp; Migration</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="changelog/index.html">Changes and Migration</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">buildstockbatch</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Project Definition</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/project_defn.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="project-definition">
<h1>Project Definition<a class="headerlink" href="#project-definition" title="Permalink to this headline">¶</a></h1>
<p>Most of the project definition happens in a project folder in the
checked out copy of the resstock or comstock repo. However, for this library to
work, a separate project YAML file provides the details needed for the
batch run. An example file is in this repo as
<code class="docutils literal notranslate"><span class="pre">project_resstock_national.yml</span></code> as shown below.</p>
<div class="code yaml highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">schema_version</span><span class="p">:</span> <span class="s1">&#39;0.3&#39;</span>
<span class="n">buildstock_directory</span><span class="p">:</span> <span class="o">../</span><span class="n">resstock</span>  <span class="c1"># Relative to this file or absolute</span>
<span class="n">project_directory</span><span class="p">:</span> <span class="n">project_national</span>  <span class="c1"># Relative to buildstock_directory</span>
<span class="n">output_directory</span><span class="p">:</span> <span class="o">/</span><span class="n">scratch</span><span class="o">/</span><span class="n">nmerket</span><span class="o">/</span><span class="n">national_test_outputs2</span>
<span class="c1"># weather_files_url: https://data.nrel.gov/system/files/156/BuildStock_TMY3_FIPS.zip</span>
<span class="n">weather_files_path</span><span class="p">:</span> <span class="o">/</span><span class="n">shared</span><span class="o">-</span><span class="n">projects</span><span class="o">/</span><span class="n">buildstock</span><span class="o">/</span><span class="n">weather</span><span class="o">/</span><span class="n">BuildStock_TMY3_FIPS</span><span class="o">.</span><span class="n">zip</span>  <span class="c1"># Relative to this file or absolute path to zipped weather files</span>

<span class="n">sampler</span><span class="p">:</span>
  <span class="nb">type</span><span class="p">:</span> <span class="n">residential_quota_downselect</span>
  <span class="n">args</span><span class="p">:</span>
    <span class="n">n_datapoints</span><span class="p">:</span> <span class="mi">350000</span>
    <span class="n">logic</span><span class="p">:</span>
      <span class="o">-</span> <span class="n">Geometry</span> <span class="n">Building</span> <span class="n">Type</span> <span class="n">RECS</span><span class="o">|</span><span class="n">Single</span><span class="o">-</span><span class="n">Family</span> <span class="n">Detached</span>
      <span class="o">-</span> <span class="n">Vacancy</span> <span class="n">Status</span><span class="o">|</span><span class="n">Occupied</span>
    <span class="n">resample</span><span class="p">:</span> <span class="n">false</span>

<span class="n">workflow_generator</span><span class="p">:</span>
  <span class="nb">type</span><span class="p">:</span> <span class="n">residential_default</span>
  <span class="n">args</span><span class="p">:</span>
    <span class="n">timeseries_csv_export</span><span class="p">:</span>
      <span class="n">reporting_frequency</span><span class="p">:</span> <span class="n">Hourly</span>
      <span class="n">include_enduse_subcategories</span><span class="p">:</span> <span class="n">true</span>

<span class="n">baseline</span><span class="p">:</span>
  <span class="n">n_buildings_represented</span><span class="p">:</span> <span class="mi">133172057</span>  <span class="c1"># Total number of residential dwelling units in contiguous United States, including unoccupied units, resulting from a census tract level query of ACS 5-yr 2016 (i.e. 2012-2016), using this script: https://github.com/NREL/resstock-estimation/blob/master/sources/spatial/tsv_maker.py.</span>

<span class="n">upgrades</span><span class="p">:</span>
  <span class="o">-</span> <span class="n">upgrade_name</span><span class="p">:</span> <span class="n">Triple</span><span class="o">-</span><span class="n">Pane</span> <span class="n">Windows</span>
    <span class="n">options</span><span class="p">:</span>
      <span class="o">-</span> <span class="n">option</span><span class="p">:</span> <span class="n">Windows</span><span class="o">|</span><span class="n">Low</span><span class="o">-</span><span class="n">E</span><span class="p">,</span> <span class="n">Triple</span><span class="p">,</span> <span class="n">Non</span><span class="o">-</span><span class="n">metal</span><span class="p">,</span> <span class="n">Air</span><span class="p">,</span> <span class="n">L</span><span class="o">-</span><span class="n">Gain</span>
<span class="c1">#        apply_logic:</span>
        <span class="n">costs</span><span class="p">:</span>
          <span class="o">-</span> <span class="n">value</span><span class="p">:</span> <span class="mf">45.77</span>
            <span class="n">multiplier</span><span class="p">:</span> <span class="n">Window</span> <span class="n">Area</span> <span class="p">(</span><span class="n">ft</span><span class="o">^</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">lifetime</span><span class="p">:</span> <span class="mi">30</span>

<span class="n">eagle</span><span class="p">:</span>
  <span class="n">n_jobs</span><span class="p">:</span> <span class="mi">4</span>
  <span class="n">minutes_per_sim</span><span class="p">:</span> <span class="mi">4</span>
  <span class="n">account</span><span class="p">:</span> <span class="n">enduse</span>
  <span class="n">sampling</span><span class="p">:</span>
    <span class="n">time</span><span class="p">:</span> <span class="mi">5</span>
  <span class="n">postprocessing</span><span class="p">:</span>
    <span class="n">time</span><span class="p">:</span> <span class="mi">10</span>
    <span class="n">n_workers</span><span class="p">:</span> <span class="mi">1</span>

<span class="n">aws</span><span class="p">:</span>
  <span class="c1"># The job_identifier should be unique, start with alpha, not include dashes, and limited to 10 chars or data loss can occur</span>
  <span class="n">job_identifier</span><span class="p">:</span> <span class="n">test_proj</span>
  <span class="n">s3</span><span class="p">:</span>
    <span class="n">bucket</span><span class="p">:</span> <span class="n">resbldg</span><span class="o">-</span><span class="n">datasets</span>
    <span class="n">prefix</span><span class="p">:</span> <span class="n">testing</span><span class="o">/</span><span class="n">user_test</span>
  <span class="n">emr</span><span class="p">:</span>
    <span class="n">worker_instance_count</span><span class="p">:</span> <span class="mi">1</span>
  <span class="n">region</span><span class="p">:</span> <span class="n">us</span><span class="o">-</span><span class="n">west</span><span class="o">-</span><span class="mi">2</span>
  <span class="n">use_spot</span><span class="p">:</span> <span class="n">true</span>
  <span class="n">batch_array_size</span><span class="p">:</span> <span class="mi">10</span>
  <span class="c1"># To receive email updates on job progress accept the request to receive emails that will be sent from Amazon</span>
  <span class="n">notifications_email</span><span class="p">:</span> <span class="n">user</span><span class="nd">@nrel</span><span class="o">.</span><span class="n">gov</span>

<span class="n">postprocessing</span><span class="p">:</span>
  <span class="n">aggregate_timeseries</span><span class="p">:</span> <span class="n">true</span>
  <span class="n">aws</span><span class="p">:</span>
    <span class="n">region_name</span><span class="p">:</span> <span class="s1">&#39;us-west-2&#39;</span>
    <span class="n">s3</span><span class="p">:</span>
      <span class="n">bucket</span><span class="p">:</span> <span class="n">resbldg</span><span class="o">-</span><span class="n">datasets</span>
      <span class="n">prefix</span><span class="p">:</span> <span class="n">resstock</span><span class="o">-</span><span class="n">athena</span><span class="o">/</span><span class="n">calibration_runs_new</span>
    <span class="n">athena</span><span class="p">:</span>
      <span class="n">glue_service_role</span><span class="p">:</span> <span class="n">service</span><span class="o">-</span><span class="n">role</span><span class="o">/</span><span class="n">AWSGlueServiceRole</span><span class="o">-</span><span class="n">default</span>
      <span class="n">database_name</span><span class="p">:</span> <span class="n">testing</span>
      <span class="n">max_crawling_time</span><span class="p">:</span> <span class="mi">300</span> <span class="c1">#time to wait for the crawler to complete before aborting it</span>
</pre></div>
</div>
<p>The next few paragraphs will describe each section of the file and what it does.</p>
<div class="section" id="reference-the-project">
<h2>Reference the project<a class="headerlink" href="#reference-the-project" title="Permalink to this headline">¶</a></h2>
<p>First we tell it what project we’re running with the following keys:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">buildstock_directory</span></code>: The absolute (or relative to this YAML file) path of the <a class="reference external" href="https://github.com/NREL/resstock">ResStock</a>
repository.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">project_directory</span></code>: The relative (to the <code class="docutils literal notranslate"><span class="pre">buildstock_directory</span></code>) path of the project.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">schema_version</span></code>: The version of the project yaml file to use and validate - currently the minimum version is <code class="docutils literal notranslate"><span class="pre">0.3</span></code>.</p></li>
</ul>
</div>
<div class="section" id="weather-files">
<h2>Weather Files<a class="headerlink" href="#weather-files" title="Permalink to this headline">¶</a></h2>
<p>Each batch of simulations depends on a number of weather files. These
are provided in a zip file. This can be done with <strong>one</strong> of the
following keys:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">weather_files_url</span></code>: Where the zip file of weather files can be downloaded from.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">weather_files_path</span></code>: Where on this machine to find the zipped weather files. This can be absolute or relative
(to this file).</p></li>
</ul>
<p>Weather files for Typical Meteorological Years (TMYs) can be obtained from the <a class="reference external" href="https://data.nrel.gov/submissions/128">NREL data catalog</a>.</p>
<p>Historical weather data for Actual Meteorological Years (AMYs) can be purchased in EPW format from various private companies. NREL users of buildstock batch can use NREL-owned AMY datasets by setting <code class="docutils literal notranslate"><span class="pre">weather_files_url</span></code> to a zip file located on <a class="reference external" href="https://app.box.com/s/atyl2q9v74kssjx5n14lbyhs1j6rt8ry">Box</a>.</p>
<div class="section" id="custom-weather-files">
<h3>Custom Weather Files<a class="headerlink" href="#custom-weather-files" title="Permalink to this headline">¶</a></h3>
<p>To use your own custom weather files for a specific location, this can be done in <strong>one</strong> of two ways:</p>
<ul class="simple">
<li><p>Rename the filename references in your local <a class="reference external" href="https://github.com/NREL/resstock/blob/master/resources/options_lookup.tsv">options_lookup.tsv</a> in the <code class="docutils literal notranslate"><span class="pre">resources</span></code> folder to match your custom weather file names. For example, in the options_lookup tsv, the Location <code class="docutils literal notranslate"><span class="pre">AL_Birmingham.Muni.AP.722280</span></code> is matched to the <code class="docutils literal notranslate"><span class="pre">weather_file_name=USA_AL_Birmingham.Muni.AP.722280.epw</span></code>. To update the weather file for this location, the <cite>weather_file_name</cite> field needs to be updated to match your new name specified.</p></li>
<li><p>Rename your custom .epw weather file to match the references in your local <a class="reference external" href="https://github.com/NREL/resstock/blob/master/resources/options_lookup.tsv">options_lookup.tsv</a> in the <code class="docutils literal notranslate"><span class="pre">resources</span></code> folder.</p></li>
</ul>
</div>
</div>
<div class="section" id="sampler">
<h2>Sampler<a class="headerlink" href="#sampler" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">sampler</span></code> key defines the type of building sampler to be used for the batch of simulations. The purpose of the sampler is to enumerate the buildings and building characteristics to be run as part of the building stock simulation. It has two arguments, <code class="docutils literal notranslate"><span class="pre">type</span></code> and <code class="docutils literal notranslate"><span class="pre">args</span></code>.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">type</span></code> tells buildstockbatch which sampler class to use.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">args</span></code> are passed to the sampler to define how it is run.</p></li>
</ul>
<p>Different samplers are available for ResStock and ComStock and variations thereof. Details of what samplers are available and their arguments are available at <a class="reference internal" href="samplers/index.html"><span class="doc">Samplers</span></a>.</p>
</div>
<div class="section" id="workflow-generator">
<h2>Workflow Generator<a class="headerlink" href="#workflow-generator" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">workflow_generator</span></code> key defines which workflow generator will be used to transform a building description from a set of high level characteristics into an OpenStudio workflow that in turn generates the detailed EnergyPlus model. It has two arguments, <code class="docutils literal notranslate"><span class="pre">type</span></code> and <code class="docutils literal notranslate"><span class="pre">args</span></code>.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">type</span></code> tells buildstockbatch which workflow generator class to use.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">args</span></code> are passed to the sampler to define how it is run.</p></li>
</ul>
<p>Different workflow generators are available for ResStock and ComStock and variations thereof. Details of what workflow generators and their arguments are available at <a class="reference internal" href="workflow_generators/index.html"><span class="doc">Workflow Generators</span></a>.</p>
</div>
<div class="section" id="baseline-simulations-incl-sampling-algorithm">
<h2>Baseline simulations incl. sampling algorithm<a class="headerlink" href="#baseline-simulations-incl-sampling-algorithm" title="Permalink to this headline">¶</a></h2>
<p>Information about baseline simulations are listed under the <code class="docutils literal notranslate"><span class="pre">baseline</span></code> key.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">n_buildings_represented</span></code>: The number of buildings that this sample is meant to represent.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">skip_sims</span></code>: Include this key to control whether the set of baseline simulations are run. The default (i.e., when
this key is not included) is to run all the baseline simulations. No results csv table with baseline characteristics
will be provided when the baseline simulations are skipped.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">custom_gems</span></code>: <strong>VERY ADVANCED FEATURE - NOT SUPPORTED - ONLY ATTEMPT USING SINGULARITY CONTAINERS ON EAGLE</strong> This
activates the <code class="docutils literal notranslate"><span class="pre">bundle</span></code> and <code class="docutils literal notranslate"><span class="pre">bundle_path</span></code> interfaces in the OpenStudio CLI to allow for custom gem packages (needed
to support rapid development of the standards gem.) This actually works extraordinarily well if the singularity
image is properly configured but that’s easier said than done. The la100 branch on the nrel/docker-openstudio repo
is a starting place if this is required.</p></li>
</ul>
</div>
<div class="section" id="openstudio-version-overrides">
<h2>OpenStudio Version Overrides<a class="headerlink" href="#openstudio-version-overrides" title="Permalink to this headline">¶</a></h2>
<p>This is a feature only used by ComStock at the moment. Please refer to the ComStock HPC documentation for additional
details on the correct configuration. This is noted here to explain the presence of two keys in the version <code class="docutils literal notranslate"><span class="pre">0.2</span></code>
schema: <code class="docutils literal notranslate"><span class="pre">os_version</span></code> and <code class="docutils literal notranslate"><span class="pre">os_sha</span></code>.</p>
</div>
<div class="section" id="upgrade-scenarios">
<h2>Upgrade Scenarios<a class="headerlink" href="#upgrade-scenarios" title="Permalink to this headline">¶</a></h2>
<p>Under the <code class="docutils literal notranslate"><span class="pre">upgrades</span></code> key is a list of upgrades to apply with the
following properties:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">upgrade_name</span></code>: (required) The name that will be in the outputs for this
upgrade scenario.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">options</span></code>: A list of options to apply as part of this upgrade.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">option</span></code>: (required) The option to apply, in the format <code class="docutils literal notranslate"><span class="pre">parameter|option</span></code> which can be found in
<a class="reference external" href="https://github.com/NREL/resstock/blob/master/resources/options_lookup.tsv">options_lookup.tsv</a>
in <a class="reference external" href="https://github.com/NREL/resstock">ResStock</a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">apply_logic</span></code>: Logic that defines which buildings to apply the upgrade to. See
<a class="reference internal" href="filtering_logic.html#filtering-logic"><span class="std std-ref">Filtering Logic</span></a> for instructions.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">costs</span></code>: A list of costs for the upgrade.
Multiple costs can be entered and each is multiplied by a cost multiplier, described below.</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">value</span></code>: A cost for the measure, which will be multiplied by the multiplier.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">multiplier</span></code>: The cost above is multiplied by this value, which is a function of the buiding.
Since there can be multiple costs, this permits both fixed and variable costs for upgrades
that depend on the properties of the baseline building.
The multiplier needs to be from
<a class="reference external" href="https://github.com/NREL/resstock/blob/master/measures/ApplyUpgrade/measure.rb#L71-L87">this enumeration list inthe resstock or comstock repo</a>
or from the list in your branch of that repo.</p></li>
</ul>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">lifetime</span></code>: Lifetime in years of the upgrade.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">package_apply_logic</span></code>: (optional) The conditions under which this package of upgrades should be performed.
See <a class="reference internal" href="filtering_logic.html#filtering-logic"><span class="std std-ref">Filtering Logic</span></a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">reference_scenario</span></code>: (optional) The <cite>upgrade_name</cite> which should act as a reference to this upgrade to calculate
savings. All this does is that reference_scenario show up as a column in results csvs alongside the upgrade name;
Buildstockbatch will not do the savings calculation.</p></li>
</ul>
</div>
<div class="section" id="output-directory">
<h2>Output Directory<a class="headerlink" href="#output-directory" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">output_directory</span></code> specifies where the outputs of the simulation should be stored.</p>
</div>
<div class="section" id="eagle-configuration">
<h2>Eagle Configuration<a class="headerlink" href="#eagle-configuration" title="Permalink to this headline">¶</a></h2>
<p>Under the <code class="docutils literal notranslate"><span class="pre">eagle</span></code> key is a list of configuration for running the batch job on
the Eagle supercomputer.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">n_jobs</span></code>: Number of eagle jobs to parallelize the simulation into</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">minutes_per_sim</span></code>: Maximum allocated simulation time in minutes</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">account</span></code>: Eagle allocation account to charge the job to</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sampling</span></code>: Configuration for the sampling in eagle</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">time</span></code>: Maximum time in minutes to allocate to sampling job</p></li>
</ul>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">postprocessing</span></code>: Eagle configuration for the postprocessing step</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">time</span></code>: Maximum time in minutes to allocate postprocessing job</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">n_workers</span></code>: Number of eagle workers to parallelize the postprocessing job into</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="aws-configuration">
<span id="aws-config"></span><h2>AWS Configuration<a class="headerlink" href="#aws-configuration" title="Permalink to this headline">¶</a></h2>
<p>The top-level <code class="docutils literal notranslate"><span class="pre">aws</span></code> key is used to specify options for running the batch job
on the <a class="reference external" href="https://aws.amazon.com/batch/">AWS Batch</a> service.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Many of these options overlap with options specified in the
<a class="reference internal" href="#postprocessing"><span class="std std-ref">Postprocessing</span></a> section. The options here take pecedence when running
on AWS. In a future version we will break backwards compatibility in the
config file and have more consistent options.</p>
</div>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">job_identifier</span></code>: A unique string that starts with an alphabetical character,
is up to 10 characters long, and only has letters, numbers or underscore.
This is used to name all the AWS service objects to be created and
differentiate it from other jobs.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">s3</span></code>: Configuration for project data storage on s3. When running on AWS,
this overrides the s3 configuration in the <a class="reference internal" href="#post-config-opts"><span class="std std-ref">Postprocessing Configuration Options</span></a>.</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">bucket</span></code>: The s3 bucket this project will use for simulation output and processed data storage.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">prefix</span></code>: The s3 prefix at which the data will be stored.</p></li>
</ul>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">region</span></code>: The AWS region in which the batch will be run and data stored.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">use_spot</span></code>: true or false. Defaults to false if missing. This tells the project
to use the <a class="reference external" href="https://aws.amazon.com/ec2/spot/">Spot Market</a> for data
simulations, which typically yields about 60-70% cost savings.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">spot_bid_percent</span></code>: Percent of on-demand price you’re willing to pay for
your simulations. The batch will wait to run until the price drops below this
level.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">batch_array_size</span></code>: Number of concurrent simulations to run. Max: 10000.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">notifications_email</span></code>: Email to notify you of simulation completion.
You’ll receive an email at the beginning where you’ll need to accept the
subscription to receive further notification emails.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">emr</span></code>: Optional key to specify options for postprocessing using an EMR cluster. Generally the defaults should work fine.</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">manager_instance_type</span></code>: The <a class="reference external" href="https://aws.amazon.com/ec2/instance-types/">instance type</a> to use for the EMR master node. Default: <code class="docutils literal notranslate"><span class="pre">m5.xlarge</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">worker_instance_type</span></code>: The <a class="reference external" href="https://aws.amazon.com/ec2/instance-types/">instance type</a> to use for the EMR worker nodes. Default: <code class="docutils literal notranslate"><span class="pre">r5.4xlarge</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">worker_instance_count</span></code>: The number of worker nodes to use. Same as <code class="docutils literal notranslate"><span class="pre">eagle.postprocessing.n_workers</span></code>.
Increase this for a large dataset. Default: 2.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dask_worker_vcores</span></code>: The number of cores for each dask worker. Increase this if your dask workers are running out of memory. Default: 2.</p></li>
</ul>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">job_environment</span></code>: Specifies the computing requirements for each simulation.</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">vcpus</span></code>: Number of CPUs needed. default: 1.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">memory</span></code>: Amount of RAM memory needed for each simulation in MiB. default 1024. For large multifamily buildings
this works better if set to 2048.</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="postprocessing">
<span id="id3"></span><h2>Postprocessing<a class="headerlink" href="#postprocessing" title="Permalink to this headline">¶</a></h2>
<p>After a batch of simulation completes, to analyze BuildStock results the
individual simulation results are aggregated in a postprocessing step as
follows:</p>
<ol class="arabic">
<li><p>The inputs and annual outputs of each simulation are gathered together into
one table for each upgrade scenario. In older versions that ran on PAT, this
was known as the <code class="docutils literal notranslate"><span class="pre">results.csv</span></code>. This table is now made available in both
csv and parquet format.</p></li>
<li><p>Time series results for each simulation are gathered and concatenated into
fewer larger parquet files that are better suited for querying using big data
analysis tools.</p>
<p>For ResStock runs with the ResidentialScheduleGenerator, the generated schedules
are horizontally concatenated with the time series files before aggregation,
making sure the schedule values are properly lined up with the timestamps in the
<a class="reference external" href="https://github.com/NREL/resstock/issues/469#issuecomment-697849076">same way that Energeyplus handles ScheduleFiles</a>.</p>
</li>
</ol>
<div class="section" id="uploading-to-aws-athena">
<h3>Uploading to AWS Athena<a class="headerlink" href="#uploading-to-aws-athena" title="Permalink to this headline">¶</a></h3>
<p>BuildStock results can optionally be uploaded to AWS for further analysis using
Athena. This process requires appropriate access to an AWS account to be
configured on your machine. You will need to set this up wherever you use buildstockbatch.
If you don’t have
keys, consult your AWS administrator to get them set up.</p>
<ul class="simple">
<li><p><a class="reference internal" href="installation.html#aws-user-config-local"><span class="std std-ref">Local Docker AWS setup instructions</span></a></p></li>
<li><p><a class="reference internal" href="installation.html#aws-user-config-eagle"><span class="std std-ref">Eagle AWS setup instructions</span></a></p></li>
<li><p><a class="reference external" href="https://boto3.amazonaws.com/v1/documentation/api/latest/guide/quickstart.html#configuration">Detailed instructions from AWS</a></p></li>
</ul>
</div>
<div class="section" id="postprocessing-configuration-options">
<span id="post-config-opts"></span><h3>Postprocessing Configuration Options<a class="headerlink" href="#postprocessing-configuration-options" title="Permalink to this headline">¶</a></h3>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The <code class="docutils literal notranslate"><span class="pre">region_name</span></code> and <code class="docutils literal notranslate"><span class="pre">s3</span></code> info here are <strong>ignored</strong> when running <code class="docutils literal notranslate"><span class="pre">buildstock_aws</span></code>.
The configuration is defined in <a class="reference internal" href="#aws-config"><span class="std std-ref">AWS Configuration</span></a>.</p>
</div>
<p>The configuration options for postprocessing and AWS upload are:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">postprocessing</span></code>: postprocessing configuration</p>
<blockquote>
<div><ul>
<li><p><code class="docutils literal notranslate"><span class="pre">aws</span></code>: configuration related to uploading to and managing data in amazon web services. For this to work, please
<a class="reference external" href="https://boto3.amazonaws.com/v1/documentation/api/latest/guide/quickstart.html#configuration">configure aws.</a>
Including this key will cause your datasets to be uploaded to AWS, omitting it will cause them not to be uploaded.</p>
<blockquote>
<div><ul>
<li><p><code class="docutils literal notranslate"><span class="pre">region_name</span></code>: The name of the aws region to use for database creation and other services.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">s3</span></code>: Configurations for data upload to Amazon S3 data storage service.</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">bucket</span></code>: The s3 bucket into which the postprocessed data is to be uploaded to</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">prefix</span></code>: S3 prefix at which the data is to be uploaded. The complete path will become: <code class="docutils literal notranslate"><span class="pre">s3://bucket/prefix/output_directory_name</span></code></p></li>
</ul>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">athena</span></code>: configurations for Amazon Athena database creation. If this section is missing/commented-out, no
Athena tables are created.</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">glue_service_role</span></code>: The data in s3 is catalogued using Amazon Glue data crawler. An IAM role must be
present for the user that grants rights to Glue crawler to read s3 and create database catalogue. The
name of that IAM role must be provided here. Default is: “service-role/AWSGlueServiceRole-default”.
For help, consult the <a class="reference external" href="https://docs.aws.amazon.com/glue/latest/dg/create-an-iam-role.html">AWS documentation for Glue Service Roles</a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">database_name</span></code>: The name of the Athena database to which the data is to be placed. All tables in the database will be prefixed with the output directory name.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">max_crawling_time</span></code>: The maximum time in seconds to wait for the glue crawler to catalogue the data
before aborting it.</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
</ul>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="samplers/index.html" class="btn btn-neutral float-right" title="Samplers" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="installation.html" class="btn btn-neutral float-left" title="Installation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright Copyright 2021 The Alliance for Sustainable Energy.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>